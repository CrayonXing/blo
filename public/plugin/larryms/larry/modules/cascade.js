layui.define(["larryms","forms"],function(e){var o=layui.$,r=layui.larryms,f=layui.forms,t="cascade";var a=function(){this.config={elem:"",data:"",selected:[],tips:"请选择",search:false,width:null,last:false,name:"",verify:"",delimiter:",",filter:"",field:{idName:"id",titleName:"name",statusName:"status",childName:"children"},container:""};this.selected=[];this.values=[];this.names=[];this.lastValue="";this.lastName="";this.isSelected=false};a.prototype.set=function(e){var t=this;o.extend(true,t.config,e);return t};a.prototype.getData=function(e){var t;o.ajax({url:e,dataType:"json",async:false,success:function(e){t=e.data;},error:function(){r.hint(MOD_NAME+" hint：候选数据ajax请求错误 ");t=false}});return t};a.prototype.setWidth=function(){var e=this,t=e.config;if(Object.prototype.toString.call(t.width)!="[object Array]"){return/^\d+$/.test(t.width)?'style="width:'+t.width+'px;" ':" "}else{var a=t.container.parent().find("select").length;if(t.width.hasOwnProperty(a)){return/^\d+$/.test(t.width[a])?'style="width:'+t.width[a]+'px;" ':" "}}};a.prototype.setSearch=function(){return""};a.prototype.setTips=function(){var e=this,t=e.config;if(Object.prototype.toString.call(t.tips)!="[object Array]"){return t.tips}else{var a=t.container.parent().find("select").length;return t.tips.hasOwnProperty(a)?t.tips[a]:"请选择"}};a.prototype.getOptionData=function(e,t){var a=this,n=a.config.field,i=e;for(var r=0;r<t.length;r++){if("undefined"==typeof i[t[r]]){i=null;break}else if("undefined"==typeof i[t[r]][n.childName]){i=null;break}else{i=i[t[r]][n.childName]}}return i};a.prototype.change=function(e){var t=this,a=t.config;var n=e.parent();n.nextAll("div.larry-input-inline").remove();var i=[];n.parent().find("select").each(function(){i.push(o(this).get(0).selectedIndex-1)});var r=t.getOptionData(a.data,i);if(r){var l=t.createHtml(r);n.after(l);f.render("select")}t.getSelected()};a.prototype.getSelected=function(){var e=this,t=e.config,r=[],l=[],s=[],a=t.container.parent();a.find("select").each(function(e,t){var a={},n=o(this).val(),i=o(this).find("option:selected").text();a.value=n;a.name=i;r.push(n);l.push(i);s.push(a)});e.selected=s;e.values=r;e.names=l;e.lastValue=a.find("select:last").val();e.lastName=a.find("option:selected:last").text();e.isSelected=e.lastValue==""?false:true;var n=t.last===true?e.lastValue:e.values.join(t.delimiter);t.container.attr("value",n)};a.prototype.createHtml=function(e){var t=this,a=t.config,n=a.field,i="";i+='<div class="larry-input-inline" '+t.setWidth()+">";i+=" <select "+t.setSearch()+'lay-filter="'+a.filter+'">';i+='  <option value="">'+t.setTips()+"</option>";for(var r=0;r<e.length;r++){var l=e[r][n.statusName]==0?'disabled="" ':"";i+="  <option "+l+'value="'+e[r][n.idName]+'">'+e[r][n.titleName]+"</option>"}i+=" </select>";i+="</div>";return i};a.prototype.initSet=function(e){var t=this,a=t.config,n="";n+=t.createHtml(a.data);a.container.parent().append(n);e=typeof e=="undefined"?a.selected:e;var i=[],r=a.container.parent();for(var l=0;l<e.length;l++){r.find("select:last").val(e[l]);var s=r.find("select:last").get(0).selectedIndex-1;i.push(s);var o=t.getOptionData(a.data,i);if(o){var c=t.createHtml(o);r.append(c)}}f.render("select");t.getSelected()};a.prototype.render=function(e){var t=this,a=t.config;if(!e.data){r.hint("无限级分类的数据项不能为空，必须进行数据源初始化设置");return false}if(e.elem==undefined){r.hint("请设定无限级初始化顶级容器元素");return false}var n=r.elemCheck(e.elem,false);if(e.name==undefined){e.name=n.attr("name")!=undefined?n.attr("name"):e.elem.replace("#","").replace(".","")}e.container=n;if(Object.prototype.toString.call(e.data)!="[object Array]"){if(Object.prototype.toString.call(e.data)=="[object String]"){var i=t.getData(e.data);if(i==false){r.hint("数据源通过url获取错误，请检查服务端返回数据格式或是否正确返回");return false}else{e.data=i}}else{r.hint("数据项设置错误，或不能为空");return false}}a=t.set(e).config;t.initSet(a.selected);f.on("select("+a.filter+")",function(e){t.change(o(e.elem))})};var n=new a;e(t,n)});